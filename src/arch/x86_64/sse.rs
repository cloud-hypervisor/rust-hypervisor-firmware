// SPDX-License-Identifier: Apache-2.0
// Copyright 2020 Google LLC

use x86_64::registers::control::{Cr0, Cr0Flags, Cr4, Cr4Flags};

// Enable SSE2 for XMM registers (needed for EFI calling)
pub fn enable_sse() {
    let mut cr0 = Cr0::read();
    cr0.remove(Cr0Flags::EMULATE_COPROCESSOR);
    cr0.insert(Cr0Flags::MONITOR_COPROCESSOR);
    unsafe { Cr0::write(cr0) };
    let mut cr4 = Cr4::read();
    cr4.insert(Cr4Flags::OSFXSR);
    cr4.insert(Cr4Flags::OSXMMEXCPT_ENABLE);
    unsafe { Cr4::write(cr4) };
}
